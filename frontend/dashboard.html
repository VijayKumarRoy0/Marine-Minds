<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEA Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0f2027;color:#f4f4f9;}
    header{padding:20px;text-align:center;font-size:2rem;color:#00d4ff;font-weight:bold;}
    .counters{display:flex;justify-content:center;gap:40px;padding:20px;}
    .counter{font-size:1.5rem;text-align:center;}
    #reportList{padding:20px; display:flex; flex-wrap:wrap; gap:20px; justify-content:center;}
    .report-card{background:#1e2a38;padding:15px;border-radius:10px;width:280px;box-shadow:0 0 10px rgba(0,212,255,0.2);}
    .report-card h3{margin:0;color:#00d4ff;}
    .report-card p, .report-card small{color:#ccc;margin:5px 0;}
    #map{height:400px;margin:20px;}
    .controls{padding:20px;text-align:center;}
    .controls label{margin:0 10px;}
    #reportsList{padding:20px;}
    #reportItems li{background:#1e2a38;margin:5px 0;padding:8px;border-radius:6px;}
  </style>
</head>
<body>

<header>ðŸ“Š SEA Hazard Reports Dashboard</header>

<div class="counters">
  <div class="counter">Reports: <span id="reports">0</span></div>
  <div class="counter">Alerts: <span id="alerts">850</span></div>
  <div class="counter">Users: <span id="users">5000</span></div>
</div>

<!-- Cards view -->
<section id="reportList"></section>

<!-- Map -->
<div id="map"></div>

<!-- Filter + Sort controls -->
<div class="controls">
  <label for="filterType">Filter by Hazard:</label>
  <select id="filterType">
    <option value="all">All</option>
    <option value="Flood">Flood</option>
    <option value="Tsunami">Tsunami</option>
    <option value="Cyclone">Cyclone</option>
    <option value="Earthquake">Earthquake</option>
  </select>

  <label for="sortOrder">Sort:</label>
  <select id="sortOrder">
    <option value="latest">Latest First</option>
    <option value="oldest">Oldest First</option>
  </select>
</div>

<!-- List view -->
<div id="reportsList">
  <h2>Reports</h2>
  <ul id="reportItems"></ul>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Load reports
let reports = JSON.parse(localStorage.getItem("reports")) || [];

// Update counters
document.getElementById("reports").textContent = reports.length;

// Map setup
const map=L.map("map").setView([20,78],4);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(map);

let markers = []; // store markers

function updateMap(filteredReports) {
  // Clear old markers
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  filteredReports.forEach(r=>{
    let lat = r.lat || 20 + Math.random()*10;
    let lng = r.lng || 78 + Math.random()*10;
    const marker = L.marker([lat,lng]).addTo(map).bindPopup(`<b>${r.hazard}</b><br>${r.location}<br>${r.time}`);
    markers.push(marker);
  });
}

// Render both views
function renderReports() {
  let filtered = [...reports];

  // Filtering
  const type = document.getElementById("filterType").value;
  if(type !== "all"){
    filtered = filtered.filter(r=>r.hazard===type);
  }

  // Sorting
  const order = document.getElementById("sortOrder").value;
  filtered.sort((a,b)=> order==="latest" ? new Date(b.time)-new Date(a.time) : new Date(a.time)-new Date(b.time));

  // Render report cards
  const reportList = document.getElementById("reportList");
  reportList.innerHTML = "";
  if(filtered.length===0){
    reportList.innerHTML="<p>No reports match this filter.</p>";
  } else {
    filtered.forEach(r=>{
      const card=document.createElement("div");
      card.className="report-card";
      card.innerHTML=`
        <h3>${r.hazard} @ ${r.location}</h3>
        <p><strong>Name:</strong> ${r.name}</p>
        <p><strong>Description:</strong> ${r.desc}</p>
        <small>ðŸ•’ ${r.time}</small>
      `;
      reportList.appendChild(card);
    });
  }

  // Render list view
  const list = document.getElementById("reportItems");
  list.innerHTML = "";
  filtered.forEach(r=>{
    const li=document.createElement("li");
    li.innerHTML=`<strong>${r.hazard}</strong> - ${r.location} <br><small>${r.time}</small>`;
    list.appendChild(li);
  });

  // Update map pins
  updateMap(filtered);
}

// Attach events
document.getElementById("filterType").addEventListener("change", renderReports);
document.getElementById("sortOrder").addEventListener("change", renderReports);

// Initial render
renderReports();
</script>

</body>
</html>
