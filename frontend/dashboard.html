<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEA Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* ...tera style code wahi rahega... */
  </style>
</head>
<body>

<header>ðŸ“Š SEA Hazard Reports Dashboard</header>

<div class="counters">
  <div class="counter">Reports: <span id="reports">0</span></div>
  <div class="counter">Alerts: <span id="alerts">850</span></div>
  <div class="counter">Users: <span id="users">5000</span></div>
</div>

<section id="reportList"></section>
<div id="map"></div>

<div class="controls">
  <label for="filterType">Filter by Hazard:</label>
  <select id="filterType">
    <option value="all">All</option>
    <option value="Flood">Flood</option>
    <option value="Tsunami">Tsunami</option>
    <option value="Cyclone">Cyclone</option>
    <option value="Earthquake">Earthquake</option>
  </select>

  <label for="sortOrder">Sort:</label>
  <select id="sortOrder">
    <option value="latest">Latest First</option>
    <option value="oldest">Oldest First</option>
  </select>
</div>

<div id="reportsList">
  <h2>Reports</h2>
  <ul id="reportItems"></ul>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_URL = "https://marine-minds-backend-t6yh.onrender.com/reports";
let reports = [];

// Load reports from backend
async function loadReports() {
  try {
    const res = await fetch(API_URL);
    reports = await res.json();

    // Update counters
    document.getElementById("reports").textContent = reports.length;

    // Render reports on dashboard
    renderReports();
  } catch (err) {
    console.error("Error loading reports:", err);
  }
}

// Map setup
const map = L.map("map").setView([20,78],4);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(map);

let markers = []; // store markers

function updateMap(filteredReports) {
  markers.forEach(m => map.removeLayer(m));
  markers = [];

  filteredReports.forEach(r=>{
    let lat = r.lat || 20 + Math.random()*10;
    let lng = r.lng || 78 + Math.random()*10;
    const marker = L.marker([lat,lng])
      .addTo(map)
      .bindPopup(<b>${r.hazard}</b><br>${r.location}<br>${r.time});
    markers.push(marker);
  });
}

function renderReports() {
  let filtered = [...reports];

  const type = document.getElementById("filterType").value;
  if(type !== "all"){
    filtered = filtered.filter(r=>r.hazard===type);
  }

  const order = document.getElementById("sortOrder").value;
  filtered.sort((a,b)=> order==="latest" ? new Date(b.time)-new Date(a.time) : new Date(a.time)-new Date(b.time));

  const reportList = document.getElementById("reportList");
  reportList.innerHTML = "";
  if(filtered.length===0){
    reportList.innerHTML="<p>No reports match this filter.</p>";
  } else {
    filtered.forEach(r=>{
      const card=document.createElement("div");
      card.className="report-card";
      card.innerHTML=`
        <h3>${r.hazard} @ ${r.location}</h3>
        <p><strong>Name:</strong> ${r.name}</p>
        <p><strong>Description:</strong> ${r.desc}</p>
        <small>ðŸ•’ ${r.time}</small>
      `;
      reportList.appendChild(card);
    });
  }

  const list = document.getElementById("reportItems");
  list.innerHTML = "";
  filtered.forEach(r=>{
    const li=document.createElement("li");
    li.innerHTML=<strong>${r.hazard}</strong> - ${r.location} <br><small>${r.time}</small>;
    list.appendChild(li);
  });

  updateMap(filtered);
}

document.getElementById("filterType").addEventListener("change", renderReports);
document.getElementById("sortOrder").addEventListener("change", renderReports);

loadReports();
</script>

</body>
</html>
